<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.noerror.Mapper.goods_mapper">


<!-- 제품유형에 따른 식품분류 선택 -->
<select id="gd_class" resultType="String" parameterType="Map">
	SELECT
	<choose>
	<when test="key == 'pd_lc'">
		DISTINCT PRODUCT_CLASS1 FROM PRODUCTS_CLASS 
	</when>
	<when test="key == 'itm_lc'">
		DISTINCT ITEMS_CLASS1 FROM ITEMS_CLASS 
	</when>
	</choose>
</select>


<!-- 소분류 선택 -->
<select id="s_class" resultType="String" parameterType="Map">
	SELECT
	<choose>
	<when test="key2 == 'pd_sc'">
		PRODUCT_CLASS2 FROM PRODUCTS_CLASS WHERE PRODUCT_CLASS1 = #{PRODUCT_CLASS1}
	</when>
	<when test="key2 == 'itm_sc'">
		ITEMS_CLASS2 FROM ITEMS_CLASS WHERE ITEMS_CLASS1 = #{ITEMS_CLASS1}
	</when>
	</choose>
</select>



<!-- 완제품 식품분류 목록 출력 -->
<!-- <select id="pd_class_list" resultType="String" parameterType="Map"> -->
<!-- 	SELECT -->
<!-- 	<choose> -->
<!-- 	<when test="key == null"> -->
<!-- 		DISTINCT PRODUCT_CLASS1 FROM PRODUCTS_CLASS  -->
<!-- 	</when> -->
<!-- 	<otherwise> -->
<!-- 		PRODUCT_CLASS2 FROM PRODUCTS_CLASS WHERE PRODUCT_CLASS1 = #{PRODUCT_CLASS1} -->
<!-- 	</otherwise> -->
<!-- 	</choose> -->
<!-- </select> -->



<!-- 상품코드 중복확인 -->
<select id="code_dupl" resultType="int" parameterType="kr.co.noerror.DTO.products_DTO">
	SELECT COUNT(*) AS CNT FROM 
	<choose>
		<when test="PRODUCT_TYPE == '완제품' or PRODUCT_TYPE == '반제품'">
			PRODUCTS WHERE PRODUCT_CODE = #{PRODUCT_CODE}
		</when>
		<when test="ITEM_TYPE == '부자재'">
			ITEMS WHERE ITEM_CODE = #{ITEM_CODE}
		</when>
	</choose>
</select>

<!-- 완제품 등록  -->
<insert id="pd_insert"  parameterType="kr.co.noerror.DTO.products_DTO">
	INSERT INTO PRODUCTS 
	VALUES 
	(PRODUCTS_NO.NEXTVAL, #{PRODUCT_CODE}, #{PRODUCT_NAME}, #{PRODUCT_TYPE}, 
	#{PRODUCT_CLASS1}, #{PRODUCT_CLASS2}, #{PRODUCT_SPEC}, #{PRODUCT_UNIT}, 
	#{PRODUCT_COST}, #{PRODUCT_PRICE}, #{PD_SAFE_STOCK}, 
	#{FILE_NM, jdbcType=CLOB}, #{FILE_RENM, jdbcType=VARCHAR}, #{API_FNM, jdbcType=VARCHAR}, #{IMG_SRC, jdbcType=CLOB}, 
	#{USE_FLAG}, #{EXP_FLAG}, #{MEMO, jdbcType=CLOB}, SYSDATE, NULL)
</insert>

<!-- 부자재 등록  -->
<insert id="itm_insert"  parameterType="kr.co.noerror.DTO.products_DTO">
	INSERT INTO ITEMS 
	VALUES 
	(ITEMS_NO.NEXTVAL, #{ITEM_CODE}, #{ITEM_NAME}, #{ITEM_TYPE}, 
	#{ITEM_CLASS1}, #{ITEM_CLASS2}, #{ITEM_SPEC}, #{ITEM_UNIT}, 
	#{ITEM_COST}, #{ITM_SAFE_STOCK},  
	#{FILE_NM, jdbcType=CLOB}, #{FILE_RENM, jdbcType=VARCHAR}, #{API_FNM, jdbcType=VARCHAR}, #{IMG_SRC, jdbcType=CLOB}, 
	#{COMPANY_CODE}, #{USE_FLAG}, #{EXP_FLAG}, #{MEMO, jdbcType=CLOB}, SYSDATE, NULL)
</insert>

<!-- 제품총 개수  -->
<!-- <select id="pd_all_ea" resultType="int"> -->
<!-- 	SELECT COUNT (*) FROM  -->
<!-- 	<choose> -->
<!-- 		<when test="type=='product' or type==null"> -->
<!-- 		PRODUCTS -->
<!-- 		</when> -->
<!-- 		<when test="type=='item'"> -->
<!-- 		ITEMS -->
<!-- 		</when> -->
<!-- 		<when test="type=='consume'"> -->
<!-- 		ITEMS -->
<!-- 		</when> -->
<!-- 	</choose> -->
<!-- </select> -->

<select id="gd_all_ea_sch" resultType="int" parameterType="Map">
	SELECT COUNT (*) FROM
	<if test="type == 'product' or type == null">
		PRODUCTS
		<if test="sclass != null">
			<where>
			PRODUCT_CLASS2 = #{sclass} 
			</where>
		</if>
		<if test="search_opt == 'all' and keyword != null"> 
			<where>
			 (PRODUCT_CODE LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_NAME LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_CLASS1 LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_CLASS2 LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_SPEC LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_UNIT LIKE '%'||#{keyword}||'%' OR
			 MEMO LIKE '%'||#{keyword}||'%'
			 ) 
			</where>
		</if>
		<if test="search_opt == 'pd_name' and keyword != null"> 
			<where>
			 PRODUCT_NAME LIKE '%'||#{keyword}||'%' 
			</where>
		</if>
	</if>
	<if test="type == 'item'">
		ITEMS
		<if test="sclass != null">
			<where>
			ITEM_CLASS2 = #{sclass} 
			</where>
		</if>
		<if test="search_opt == 'all' and keyword != null"> 
			<where>
			 (ITEM_CODE LIKE '%'||#{keyword}||'%' OR
			 ITEM_NAME LIKE '%'||#{keyword}||'%' OR
			 ITEM_CLASS1 LIKE '%'||#{keyword}||'%' OR
			 ITEM_CLASS2 LIKE '%'||#{keyword}||'%' OR
			 ITEM_SPEC LIKE '%'||#{keyword}||'%' OR
			 ITEM_UNIT LIKE '%'||#{keyword}||'%' OR
			 MEMO LIKE '%'||#{keyword}||'%'
			 ) 
			</where>
		</if>
		<if test="search_opt == 'pd_name' and keyword != null"> 
			<where>
			 ITEM_NAME LIKE '%'||#{keyword}||'%' 
			</where>
		</if>
	</if>
</select>


<!-- 제품 리스트 보기 -->
<!-- <select id="pd_all_list" resultType="kr.co.noerror.DTO.products_DTO" > -->
<!-- 	SELECT * FROM  -->
<!-- 	<choose> -->
<!-- 		<when test="type=='product' or type==null"> -->
<!-- 		PRODUCTS ORDER BY PIDX DESC -->
<!-- 		</when> -->
<!-- 		<when test="type=='item'"> -->
<!-- 		ITEMS ORDER BY IIDX DESC -->
<!-- 		</when> -->
<!-- 		<when test="type=='consume'"> -->
<!-- 		ITEMS ORDER BY IIDX DESC -->
<!-- 		</when> -->
<!-- 	</choose> -->
<!-- </select> -->
<select id="gd_all_list_sch" resultType="kr.co.noerror.DTO.products_DTO" parameterType="Map">
	SELECT * FROM 
	(SELECT ROWNUM AS rnum, a.* FROM 
	(SELECT * FROM 
	<if test="type == 'product' or type == null">
		PRODUCTS
		
		<if test="sclass != null">
			<where>
			PRODUCT_CLASS2 = #{sclass} 
			</where>
		</if>
		<if test="search_opt == 'all' and keyword != null"> 
			<where>
			 (PRODUCT_CODE LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_NAME LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_CLASS1 LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_CLASS2 LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_SPEC LIKE '%'||#{keyword}||'%' OR
			 PRODUCT_UNIT LIKE '%'||#{keyword}||'%' OR
			 MEMO LIKE '%'||#{keyword}||'%'
			 ) 
			</where>
		</if>
		<if test="search_opt == 'pd_name' and keyword != null"> 
			<where>
			 PRODUCT_NAME LIKE '%'||#{keyword}||'%' 
			</where>
		</if>
		ORDER BY PIDX DESC ) a
		WHERE ROWNUM &lt;= #{end} )
		WHERE rnum &gt;= #{start}
	</if>
	<if test="type == 'item'">
		ITEMS
		<if test="sclass != null">
			<where>
			ITEM_CLASS2 = #{sclass} 
			</where>
		</if>
		<if test="search_opt == 'all' and keyword != null"> 
			<where>
			 (ITEM_CODE LIKE '%'||#{keyword}||'%' OR
			 ITEM_NAME LIKE '%'||#{keyword}||'%' OR
			 ITEM_CLASS1 LIKE '%'||#{keyword}||'%' OR
			 ITEM_CLASS2 LIKE '%'||#{keyword}||'%' OR
			 ITEM_SPEC LIKE '%'||#{keyword}||'%' OR
			 ITEM_UNIT LIKE '%'||#{keyword}||'%' OR
			 MEMO LIKE '%'||#{keyword}||'%'
			 ) 
			</where>
		</if>
		<if test="search_opt == 'pd_name' and keyword != null"> 
			<where>
			 ITEM_NAME LIKE '%'||#{keyword}||'%' 
			</where>
		</if>
		ORDER BY IIDX DESC ) a
		WHERE ROWNUM &lt;= #{end} )
		WHERE rnum &gt;= #{start}
	</if>
</select>








<!-- 제품 상세보기 -->
<select id="pd_one_detail" resultType="kr.co.noerror.DTO.products_DTO" parameterType="Map">
	SELECT * FROM 
	<choose>
		<when test="type=='product' or type==null">
		PRODUCTS WHERE PRODUCT_CODE = #{PRODUCT_CODE}
		</when>
		<when test="type=='item'">
		ITEMS WHERE ITEM_CODE = #{ITEM_CODE}
		</when>
	</choose>
</select>








<!-- 제품삭제 -->
<delete id="pd_delete"  parameterType="Map">
	DELETE FROM 
	<choose>
		<when test="type=='product'">
		PRODUCTS WHERE PIDX = #{PIDX, jdbcType=INTEGER} AND PRODUCT_CODE = #{PRODUCT_CODE, jdbcType=VARCHAR}
		</when>
		<when test="type=='item'">
		ITEMS WHERE IIDX = #{IIDX, jdbcType=INTEGER} AND ITEM_CODE = #{ITEM_CODE, jdbcType=VARCHAR}
		</when>
	</choose>

</delete>


<select id="lclass_ck" resultType="String" parameterType="String">
	SELECT PRODUCT_CLASS1 FROM PRODUCTS_CLASS WHERE PRODUCT_CLASS2 = #{PRODUCT_CLASS2}
</select>


</mapper>